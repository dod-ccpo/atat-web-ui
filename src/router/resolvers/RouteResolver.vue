<template>
  <div></div>
</template>

<script lang="ts">
import Vue from "vue";
import { Component } from "vue-facing-decorator";
import { RouteLocationNormalized } from "vue-router";

// route resolver invoker
import { InvokeRouteResolver } from "./index";

Component.registerHooks(["beforeRouteEnter"]);
@Component({})
export default class RouteResolver extends Vue {
  private resolveRoute(current: string): void {
    const routeResolver = this.$route.params.resolver;

    if (!routeResolver) {
      throw new Error("could not obtain step resolver");
    }

    const routeName = InvokeRouteResolver(routeResolver, current);
    this.$router.push({ name: routeName });
  }

  public async beforeRouteEnter(
    to: RouteLocationNormalized,
    from: RouteLocationNormalized,
    next: (n: unknown) => void
  ): Promise<void> {
    next(async (vm: { resolveRoute: (current: string) => void }) => {
      const current = from.name as string;
      if (!current) {
        throw new Error("from route name undefined");
      }

      vm.resolveRoute(current);
    });
  }
}
</script>
